<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Soniweb: Epilogue</title>
		<meta name="description" content="An update to the internet packet sonification project with a focus on making the sonified objects flexible and responsive">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Jackson">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="Jackson">
		<style>
			/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono,
		Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono,
		Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New,
		Courier, monospace;
}

/* Theme colors */
:root {
	color-scheme: light dark;

	--color-gray-20: #333333;
	--color-gray-50: #7f7f7f;
	--color-gray-90: #e5e5e5;

	--syntax-tab-size: 2;
}
.dark-mode {
	--color-gray-20: #cccccc;
	--color-gray-50: #808080;
	--color-gray-90: #1a1a1a;
}
/* @media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #cccccc;
		--color-gray-50: #808080;
		--color-gray-90: #1a1a1a;
	}
} */

/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

main {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	position: relative;
}

:root {
	--wave-width: 30px;
	--wave-height: 10px;
}

.wave-divider {
	width: 100%;
	height: var(--wave-height);
	background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='10'%3E%3Cpath d='M0 5q15-5 30 0t30 0' stroke='lightgray' fill='none' stroke-width='1.5'/%3E%3C/svg%3E")
		repeat-x bottom;
	background-size: var(--wave-width) var(--wave-height);
}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
pre:not([class*="language-"]) {
	margin: 0.5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em 0.5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em;
}
.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
	margin-right: 2em;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
	margin-right: 1em;
	padding-bottom: 0.5em;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	margin-bottom: 1em;
	padding-left: 1.5em; /* Add left padding to make room for the arrow */
	position: relative;
}
.postlist-item::before {
	content: "\2192"; /* Default to arrow */
	margin-right: 0.5em;
	color: var(--color-gray-20);
	left: 0;
	top: 0.2em;
	position: absolute;
	transition: all 0.5s ease-out;
	filter: saturate(100%);
	transform: scale(1);
}
.postlist-item[data-emoji]::before {
	content: attr(data-emoji);
}
.postlist-item::before {
	transition: all 0.5s ease-out;
}
.postlist-item:hover::before,
.postlist-item:focus-within::before {
	animation: pulseSat 2s linear infinite;
}

.postlist-item:not(:hover)::before {
	animation: none;
	filter: saturate(100%);
	transform: scale(1);
	transition: all 0.5s ease-out;
}
@keyframes pulseSat {
	0%,
	50%,
	100% {
		filter: saturate(100%);
		transform: scale(1);
	}
	25% {
		filter: saturate(50%);
		transform: scale(0.8);
	}
	75% {
		filter: saturate(150%);
		transform: scale(1.2);
	}
}
.postlist-date {
	color: var(--color-gray-20);
	font-size: 0.8125em; /* 13px /16 */
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: 100%;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item {
	position: relative;
}

.postlist-item:has(.postlist-link:hover) .postlist-date::after {
	content: attr(data-tooltip);
	padding-left: 1em;
	position: absolute;
	color: var(--color-gray-20);
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	/* BUG - This needs to be set to the width of the postlist-item */
	max-width: calc(100% - 12em);
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: 0.1em;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

/* Starting custom */
@font-face {
	font-family: "Sans Serif Shaded";
	src: url("/font/SansSerifShaded.ttf");
	font-weight: normal;
	font-style: normal;
}
@font-face {
	font-family: "Bonbance";
	src: url("/font/Bonbance-BoldCondensed.woff2") format("woff2");
	font-weight: normal;
	font-style: normal;
}
@font-face {
	font-family: "AntiqueSerie";
	src: url("/font/AntiqueSerie-Regular.woff2") format("woff2");
	font-weight: normal;
	font-style: normal;
}
@font-face {
	font-family: "Anybody";
	src: url("/font/Anybody-VariableFont_wdth,wght.ttf") format("ttf");
	font-weight: normal;
	font-style: normal;
}
@font-face {
	font-family: "Folio";
	src: url("/font/Folio-Std-Light.woff") format("woff");
	font-weight: normal;
	font-style: normal;
}
@font-face {
	font-family: "Whirlybats";
	src: url("/font/Whirlybats.ttf") format("truetype");
}
@font-face {
	font-family: "WhirlyBirdie";
	src: url("/font/WhirlyBirdieVariable.ttf") format("truetype");
	/* font-weight: 200; */
	font-variation-settings:
		"wght" 75,
		"wdth" 75;
}
@font-face {
	font-family: "Switzer";
	src: url("/font/Switzer-Variable.woff2") format("woff2");
	font-weight: 500;
	/* font-variation-settings: "wght" 400; */
}
@font-face {
	font-family: "Rag";
	src:
		url("/font/Rag-Regular.woff2") format("woff2"),
		url("/font/Rag-Italic.woff2") format("woff2"),
		url("/font/Rag-Bold.woff2") format("woff2"),
		url("/font/Rag-BoldItalic.woff2") format("woff2");
	font-weight: 400;
	font-style: normal italic;
	font-display: swap;
}

.wb-icon {
	font-family: "Whirlybats";
	font-weight: normal;
	font-style: normal;
	display: inline-block;
	white-space: nowrap;
	word-wrap: normal;
	direction: ltr;
	font-feature-settings: "liga";
	-webkit-font-smoothing: antialiased;
	text-rendering: optimizeLegibility;
	-moz-osx-font-smoothing: grayscale;
}

:root {
	--font-family: "Rag", -apple-system, system-ui, sans-serif;
}

h1,
h2,
h3,
.letter {
	font-family: "Switzer";
}

h1 {
	display: flex;
	flex-wrap: wrap;
	gap: 0.25em;
}

header {
	gap: unset;
}

nav {
	padding-bottom: 0.5em;
	width: 100%;
	align-items: baseline;
	display: flex;
}

.nav-right {
	margin-left: auto;
	margin-right: 0;
}

.nav-toggle {
	margin-left: auto;
}

/* Dark mode toggle styles */
#dark-mode-toggle {
	background: none;
	border: none;
	cursor: pointer;
	font-size: 1em;
}

figure > * {
	max-width: 100%;
}

figcaption {
	color: var(--color-gray-20);
	text-align: center;
}

blockquote {
	padding-left: 1em;
	border-left: 2px solid var(--color-gray-90);
}

/* Talk bubble */
.talk-bubble {
	position: absolute;
	top: 12px;
	left: 0px;
	width: calc(100% - 48px);
	background: var(--color-gray-90);
	border-radius: 5px;
	padding: 1em;
	z-index: -1;
}

.talk-bubble:after {
	content: "";
	position: absolute;
	right: -7.5px;
	top: 50%;
	border: 7.5px solid transparent;
	border-left-color: var(--color-gray-90);
	border-right: 0;
	margin-top: -7.5px;
}

/* Custom header */
@media (min-width: 840px) {
	body {
		display: flex;
		justify-content: center;
		max-width: none;
		padding: 0;
	}

	.content-wrapper {
		display: flex;
		max-width: calc(40em + 200px + 1rem);
		width: 100%;
	}

	.side-header {
		position: sticky;
		top: 0;
		height: 100vh;
		width: 200px;
		overflow-y: auto;
		align-items: start;
		justify-content: end;
	}

	.side-header .nav {
		flex-direction: column;
		align-items: end;
	}

	nav {
		width: unset;
	}

	main {
		flex: 1;
		max-width: 40em;
		padding: 1rem;
	}

	.wave-divider {
		width: var(--wave-height);
		height: 150px;
		background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='60'%3E%3Cpath d='M5 0q-5 15 0 30t0 30' stroke='lightgray' fill='none' stroke-width='1.5'/%3E%3C/svg%3E")
			repeat-y right;
		background-size: var(--wave-height) var(--wave-width);
		margin-left: 1em;
		color: green;
		stroke: green;
	}

	/* Talk bubble movement */
	.side-header {
		--item-top: 12px;
		--item-rot: 0deg;
		--nav-item-height: 32px;
	}

	.talk-bubble,
	.nav-toggle {
		transform: translateY(calc(var(--item-top) - 12px));
		transition: all 0.3s ease;
	}

	.nav-toggle {
		transform: translateY(calc(var(--item-top) - 12px)) rotate(var(--item-rot));
	}

	.side-header:has(.nav-item:nth-child(1):hover) {
		--item-top: calc(12px + 0 * var(--nav-item-height));
	}
	.side-header:has(.nav-item:nth-child(2):hover) {
		--item-top: calc(12px + 1 * var(--nav-item-height));
		--item-rot: -15deg;
	}
	.side-header:has(.nav-item:nth-child(3):hover) {
		--item-top: calc(12px + 2 * var(--nav-item-height));
		--item-rot: 15deg;
	}
	.side-header:has(.nav-item:nth-child(4):hover) {
		--item-top: calc(12px + 3 * var(--nav-item-height));
		--item-rot: -15deg;
	}
}
		</style>

		<style>
			@import url('https://fonts.googleapis.com/css2?family=Anybody:ital,wght@0,100..900;1,100..900&family=Archivo:ital,wght@0,100..900;1,100..900&family=Chivo:ital,wght@0,100..900;1,100..900&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Rubik:ital,wght@0,300..900;1,300..900&family=Syne:wght@400..800&display=swap');
		</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>
		<div class="content-wrapper">
			<header class="side-header">
				<nav>
					<h2 class="visually-hidden">Top level navigation menu</h2>
					<ul class="nav">
							<li class="nav-item">
								<a href="/">Home</a>
							</li>
							<li class="nav-item">
								<a href="/blog/">Blog</a>
							</li>
							<li class="nav-item">
								<a href="/projects/">Projects</a>
							</li>
							<li class="nav-item">
								<a href="/about/">About Me</a>
							</li>
					</ul>
					<div class="nav-toggle">
						<button id="dark-mode-toggle" aria-label="Toggle dark mode">🐸</button>
					</div>
					<div class="talk-bubble"></div>
				</nav>
				
			</header>

			<main id="skip" class="container">
				<link rel="stylesheet" href="/css/lite-yt-embed.css"/>

<h1>Soniweb: Epilogue</h1>

<ul class="post-metadata">
	<li>
		<time datetime="2020-04-08">08 April 2020</time>
	</li>
</ul>

<h1 id="a-reworking-of-soniweb" tabindex="-1">A Reworking of Soniweb <a class="header-anchor" href="#a-reworking-of-soniweb">#</a></h1>
<p>The <a href="/soniweb">Soniweb</a> project was hurridly completed within the span of about a week. However, in rushing through its implementation, there were a number of unique opertunities that would have been possible with the data we were recieving. Notably, the direction of the packets (whether they were being sent or received) was not considered in the process of our sonification. This information would be quite interesting to have conveyed through sound and provide interesting knowledge about when and how often is your computer uploading information to some other server.</p>
<p>One of the <a href="https://youtu.be/Ocq3NeudsVk">issues</a> I have with sonification is the reasoning (or lack thereof) behind how aspects of data will be sonified. I feel this is a essential point of interpretation artistically that is missed by a lot of sonification projects in the pursuit of making them sonically &quot;beautiful&quot;. Too often the decisions that are being made are not necessarily drawing out acoustic features that parallel the relationships within the data. To this end, I wanted to make three adjustments to the Soniweb project. The <em>first</em> would replace sample playback to synthesized sound at the heart of the sonification, <em>second</em> would focus on shaping the synthesized sound in an extended range of parameters like envelope and pitch based on the features of the incoming packets, and <em>third</em> would be a general optimization of the python script and Pd patch to prevent stuttering or audio glitches during normal use.</p>
<figure>
			<img src="/img/soniweb-2-pd.png" width="100%" alt="A little restructured and a much better reverb implementation" />
			<figcaption>A little restructured and a much better reverb implementation</figcaption>
		</figure>
<h2 id="from-samples-to-fm-synthesis" tabindex="-1">From samples to FM synthesis <a class="header-anchor" href="#from-samples-to-fm-synthesis">#</a></h2>
<p>Our first version of Soniweb used pre-fab samples for each of the different protocols (UDP, DNS, TCP, etc.), meaning there was a considerable amount of processing in simply reading these samples into memory to play in parallel. In the previous version, there was noticeable pops and stutters as a result of web browser usage (page loads), Wireshark's backend listening to packets, and Pd producing an ambisonic environment. So, one major reason in replacing samples with a short generated FM synth would be the benefit it might have on CPU usage and memory within Pure Data.</p>
<h2 id="sonification-of-direction" tabindex="-1">Sonification of direction <a class="header-anchor" href="#sonification-of-direction">#</a></h2>
<p>It's not totally obvious how one goes about representing motions like approach or retreat. However, one nice point of reference is the <a href="https://en.wikipedia.org/wiki/Doppler_effect">Doppler effect</a>, the reason firetrucks seem to have a higher pitch when driving towards the listener and a lower pitch once they have passed. This might be the best feature representative of acoustic motion along with increasing/decreasing volume.
Í</p>
<figure text-align="center">
    <audio src="https://upload.wikimedia.org/wikipedia/commons/9/90/Speeding-car-horn_doppler_effect_sample.ogg" controls preload="none" class="m-0a display-block"></audio>
    <figcaption>Audio from Wikipedia</figcaption>
</figure>
<p>With this information I planned to give the sense of a sound arriving and departing by creating envelopes that had a short attack/long decay (departing) and long attack/short decay (arriving), each coupled with the proper pitch transformations one would observe with the doppler effect (departing - pitch falling, arriving - pitch rising). However, due to the massive number of packets that are received at once, anything longer than half a second for a single sound would quickly become overwhelming. Thus, a lot of tinkering with the timing and duration of each of these transformations was needed in order to make their different both <strong>intelligible</strong> and <strong>musical</strong>.</p>
<figure>
			<img src="/img/soniweb-2-boop.png" width="100%" alt="The new patch for one of the voices" />
			<figcaption>The new patch for one of the voices</figcaption>
		</figure>
<h2 id="filtering" tabindex="-1">Filtering <a class="header-anchor" href="#filtering">#</a></h2>
<p>Because there would be potentially dozen of packets coming within a single second, I decided to restrict this stream by 1) limiting the packet size and the frequency that packets could be registered in the python script and 2) shortening the max duration of the sound each packet will make to 150ms in Pd. These changes came after a number of other tests to see if limiting the packets by duplicate IP's (no packet can be sent from the same IP in succession) and by duplicate packet size. Both of these alternatives seemed like strange modifications to the data stream and were workarounds for my desired outcome - fewer packets at once.</p>
<p>So, after checking the very scarce documentation of pyshark, I found there was a way to grab the time that a packet was received and restricted the interval between packets manually (5ms). I also made sure that sequential packets of the same size (such as when loading an image) have a subsequently quieter sound.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Set up capture and filter by host IP and packet size</span>
capture <span class="token operator">=</span> pyshark<span class="token punctuation">.</span>LiveCapture<span class="token punctuation">(</span>
    interface<span class="token operator">=</span><span class="token string">"en0"</span><span class="token punctuation">,</span>
    only_summaries<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    bpf_filter<span class="token operator">=</span><span class="token string">"ip and host "</span><span class="token operator">+</span>host_ip<span class="token operator">+</span><span class="token string">" and length > "</span><span class="token operator">+</span>pkt_len<span class="token punctuation">)</span>

<span class="token keyword">for</span> packet <span class="token keyword">in</span> capture<span class="token punctuation">:</span>
        <span class="token comment"># Restrict flow of packets</span>
        pkt_time <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span>time<span class="token punctuation">)</span>
        delta <span class="token operator">=</span> pkt_time <span class="token operator">-</span> prior_time
        <span class="token keyword">if</span> delta <span class="token operator">></span> <span class="token number">.05</span><span class="token punctuation">:</span>
            prior_time <span class="token operator">=</span> pkt_time

            <span class="token comment"># To OSC</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># For reappearing packets of same size - reduce gain</span>
                <span class="token keyword">if</span> prior_len <span class="token operator">==</span> packet<span class="token punctuation">.</span>length<span class="token punctuation">:</span>
                    client<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span><span class="token string">"/packet_len"</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    client<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span><span class="token string">"/packet_len"</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>
                prior_len <span class="token operator">=</span> packet<span class="token punctuation">.</span>length</code></pre>
<figcaption>Filters so my ears (and computer) remain intact</figcaption>
<p>There was also a helpful flag within pyshark I had overlooked. The &quot;only_summaries&quot; flag when setting up the LiveCapture significantly reduces the information each packet carries when it enters python. Including it likely made the entire script more efficient, as the information I needed from each packet still existed within just the summaries.</p>
<h2 id="results" tabindex="-1">Results <a class="header-anchor" href="#results">#</a></h2>
<p>Interestingly, the replacement of sound samples with synthesized sound did not initially reduce the CPU usage of the script on the computer I was testing with (a 2013 Macbook Pro). This may simply be a result of how intensive the setup for testing this program but also that I had made quite extensive changes to the structure of the program as well. Both the script, Pure Data, and a web browser (or web intensive application) are needed to run to &quot;feed&quot; Pure Data packets of data. With all of these applications running, Pure Data does struggle a bit and some pops and stutters when webpages are loading, though I have noticed that this behavior with audio interruptions is also common to other applications like Zoom when there is intense web traffic happening at once.</p>
<p>After reworking the filtering system and tinkering a bit with the quality of the reverb I added (to help with spatialization), I think I ended up with something quite nice. Here's a short video, please wear headphones to experience the full effect. The code and patches can be found <a href="https://github.com/jacksongoode/soniweb">here</a>.</p>
<figure>
    <div class="iframe-wrapper pb-169">
        <iframe src="https://drive.google.com/file/d/1tLW8LHvimNzqXzyDfVpF2ZOoxleAUY0i/preview" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen alt="A demo of Soniweb (headphones required!)"></iframe>
    </div>
    <figcaption>A demo of the updated project (headphones required!)</figcaption>
</figure>

		<ul class="links-nextprev">
				<li>Previous: <a href="/blog/2020-03-09-soniweb/">Soniweb: An Experiment in Web Traffic Sonification and Ambisonics</a>
				</li>
			
				<li>Next: <a href="/blog/2020-05-20-breathing-through-max/">Breathing through Max</a>
				</li>
			
		</ul>

<script src="/js/lite-yt-embed.js" defer></script>
			</main>
		</div>
		<footer></footer>

		<!-- This page `/blog/2020-04-08-soniweb-2/` was built on 2024-08-18T07:41:48.267Z -->
	</body>
</html>
<script>
	// Toggle dark/light mode and save
const toggle = document.getElementById('dark-mode-toggle');
const root = document.documentElement;

const setTheme = isDark => {
    root.classList.toggle('dark-mode', isDark);
    root.style.colorScheme = isDark ? 'dark' : 'light';
    toggle.textContent = isDark ? '🐸' : '🐓';
    localStorage.setItem('color-scheme', isDark ? 'dark' : 'light');
};

const storedTheme = localStorage.getItem('color-scheme');
setTheme(storedTheme ? storedTheme === 'dark' : window.matchMedia('(prefers-color-scheme: dark)').matches);

toggle.onclick = () => setTheme(root.style.colorScheme !== 'dark');
</script>