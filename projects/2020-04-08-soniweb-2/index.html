<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Soniweb: Epilogue</title>
		<meta name="description" content="An update to the internet packet sonification project with a focus on making the sonified objects flexible and responsive">
		<meta name="generator" content="Eleventy v3.0.0">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Jackson">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="Jackson">

		
		
		<link rel="stylesheet" href="/css/prism.css"/>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lite-youtube-embed@0.3.2/src/lite-yt-embed.css">
		
		<style>/*
  Josh's Custom CSS Reset
  https://www.joshwcomeau.com/css/custom-css-reset/
*/
*,
*::before,
*::after {
	box-sizing: border-box;
}
* {
	line-height: calc(1em + 0.5rem);
	margin: 0;
}
body {
	-webkit-font-smoothing: antialiased;
}
img,
picture,
video,
canvas,
svg {
	display: block;
	max-width: 100%;
}
input,
button,
textarea,
select {
	font: inherit;
}
p,
h1,
h2,
h3,
h4,
h5,
h6 {
	overflow-wrap: break-word;
	margin: revert;
}
#root,
#__next {
	isolation: isolate;
}

		:root {
	color-scheme: light dark;
	--color-bg: white;
	--color-gray-20: #333333;
	--color-gray-50: #7f7f7f;
	--color-gray-90: #e5e5e5;
	--font-family: "Rag", -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono,
		Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono,
		Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New,
		Courier, monospace;
	--syntax-tab-size: 2;
	--noise-img: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 600'%3E%3Cfilter id='a'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23a)'/%3E%3C/svg%3E");
	--noise-opacity: 0.2;
	/* Josh Comeau shadows */
	--shadow-color: 0deg 0% 0%;
	--shadow-elevation-low: 0px 0.2px 0.2px hsl(var(--shadow-color) / 0.16),
		0.1px 0.8px 0.8px -3px hsl(var(--shadow-color) / 0.13);
	--shadow-elevation-medium: 0px 0.2px 0.2px hsl(var(--shadow-color) / 0.15),
		0.1px 1px 1.1px -1.5px hsl(var(--shadow-color) / 0.13),
		0.3px 4.2px 4.4px -3px hsl(var(--shadow-color) / 0.11);
	--shadow-elevation-high: 0px 0.2px 0.2px hsl(var(--shadow-color) / 0.14),
		0.1px 1.3px 1.4px -0.6px hsl(var(--shadow-color) / 0.13),
		0.2px 2.8px 2.9px -1.2px hsl(var(--shadow-color) / 0.12),
		0.5px 5.7px 6px -1.8px hsl(var(--shadow-color) / 0.11),
		0.9px 10.9px 11.5px -2.4px hsl(var(--shadow-color) / 0.11),
		1.5px 19.3px 20.3px -3px hsl(var(--shadow-color) / 0.1);
}

/* Both for system and user preference */
:root[data-theme="dark"],
.dark-mode {
	color-scheme: dark;
	--color-bg: black;
	--color-gray-20: #cccccc;
	--color-gray-50: #808080;
	--color-gray-90: #1a1a1a;
	--noise-opacity: 0.1;
}

@font-face {
	font-family: "Switzer";
	src: url("/font/Switzer-Variable.woff2") format("woff2");
	font-weight: 500;
	font-display: optional;
	/* font-variation-settings: "wght" 400; */
}
@font-face {
	font-family: "Rag";
	font-style: normal italic;
	font-weight: 400;
	src:
		url("/font/Rag-Regular.woff2") format("woff2"),
		url("/font/Rag-Italic.woff2") format("woff2"),
		url("/font/Rag-Bold.woff2") format("woff2"),
		url("/font/Rag-BoldItalic.woff2") format("woff2");
	font-display: optional;
}

/* Global stylesheet */
html {
	overflow-x: hidden;
}
html,
body {
	width: 100%;
	padding: 0;
	background-color: Canvas;
	background-color: transparent;
	color: CanvasText;
	font-family: var(--font-family);
}
body {
	/* transition:
		color 0.1s,
		background-color 0.1s; */
	/* background-color: Canvas;
		color: CanvasText; */
	display: flex;
	justify-content: center;
	max-width: none;
}

.layout-wrapper {
	display: flex;
	width: 100%;
	max-width: calc(40em + 200px + 2em);
	height: 100vh;
}

main {
	width: 100%;
	max-width: 40em;
	padding: 1em 2em;
	transition: margin 0.3s ease; /* Smooth transition for margin change in chat-active state */

	& :first-child {
		margin-top: 0;
	}

	&:where(.chat-active) {
		margin-top: 3em;
	}
}

/* Typography */
h1,
h2,
h3,
.letter {
	font-family: "Switzer";
	text-wrap: balance;
	width: fit-content;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	position: absolute;
	overflow: hidden;
	width: 1px;
	height: 1px;
	white-space: nowrap;
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
}

p:last-child {
	margin-bottom: 0;
}

.links-nextprev {
	padding: 1em 0;
	border-top: 1px dashed var(--color-gray-20);
	margin-top: 1em;
	list-style: none;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
pre:not([class*="language-"]) {
	margin: 0.5em 0;
	line-height: 1.375; /* 22px /16 */
	text-align: left;
	white-space: pre;
	word-break: normal;
	word-spacing: normal;
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
}
code {
	word-break: break-all;
}

/* Header */
.home-link {
	margin-right: 2em;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
nav {
	position: relative;
	display: flex;
	align-items: baseline;
	width: 100%;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
	padding: 0.25em 0;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
}

/* Each item in a po */
.postlist-item {
	position: relative;
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	padding-left: 1.5em; /* Add left padding to make room for the arrow */
	margin-bottom: 1em;

	&::before {
		content: "\2192"; /* Default to arrow */
		position: absolute;
		top: 0.2em;
		left: 0;
		margin-right: 0.5em;
		color: var(--color-gray-20);
		transition: all 0.5s ease-out;
		filter: saturate(100%);
		transform: scale(1);
	}

	&[data-emoji]::before {
		content: attr(data-emoji);
	}

	&:hover::before,
	&:focus-within::before {
		animation: pulseSat 2s linear infinite;
	}

	&:not(:hover)::before {
		animation: none;
		filter: saturate(100%);
		transform: scale(1);
	}

	.postlist-date::after {
		content: attr(data-tooltip);
		position: absolute;
		overflow: hidden;
		max-width: calc(100% - 12em);
		padding-left: 1em;
		color: var(--color-gray-20);
		text-overflow: ellipsis;
		white-space: nowrap;
		opacity: 0;
		visibility: hidden;
		transition:
			opacity 0.3s ease,
			visibility 0.3s ease;
	}

	&:has(.postlist-link:hover) .postlist-date::after {
		opacity: 1;
		visibility: visible;
	}

	&-active .postlist-link {
		font-weight: bold;
	}
}

@keyframes pulseSat {
	0%,
	50%,
	100% {
		filter: saturate(100%);
		transform: scale(1);
	}
	25% {
		filter: saturate(50%);
		transform: scale(0.8);
	}
	75% {
		filter: saturate(150%);
		transform: scale(1.2);
	}
}
.postlist-date {
	color: var(--color-gray-20);
	font-size: 0.8125em; /* 13px /16 */
	word-spacing: -0.5px;
}
.postlist-link {
	flex-basis: 100%;
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}

/* Tags */
.post-tag {
	display: inline-flex;
	justify-content: center;
	align-items: center;
	font-style: italic;
	text-transform: capitalize;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	margin-left: 0.1em;
	font-size: 1em;
	font-style: normal;
	text-decoration: none;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

/* Figures */
figure {
	margin: 1em 0;
}
figure > * {
	max-width: 100%;
	margin: 0 auto;
}
/* All images & videos should be in a figure */
figure :first-child {
	border-radius: 0.5em;
	box-shadow: var(--shadow-elevation-medium);
}

figcaption {
	margin-top: 0.5em;
	color: var(--color-gray-20);
	text-align: center;
}

blockquote {
	padding-left: 1em;
	border-left: 2px solid ButtonFace;
}

/* Talk bubble styling */
.nav-phrase {
	display: none;
	width: 100%;
	padding: 0 0.5em;
	cursor: text;
}

.nav-bubble {
	position: absolute;
	display: flex;
	justify-content: space-between;
	align-items: center;
	width: calc(100% - 2.5em);
	padding: 0.25em;
	margin: 0;
	background: ButtonFace;
	transition: all 0.3s ease;
	transform: translateY(calc(var(--item-top) - 12px));
	border-radius: 0.25em;

	&:after {
		content: "";
		position: absolute;
		top: 50%;
		right: -7.5px;
		border: 7.5px solid transparent;
		border-right: 0;
		margin-top: -7.5px;
		border-left-color: ButtonFace;
	}

	/* Reset position when chat is active */
	&:where(.chat-active) {
		transform: none;
	}
}

/* Talk bubble movement */
header {
	/* We need to add 1 to the active item to account for the first item */
	--item-top: calc(12px + var(--nav-item-active, 1) * var(--nav-item-height));
	--item-rot: 0deg;
	--nav-item-height: 32px;

	position: sticky;
	top: 0;
	justify-content: end;
	align-items: start;
	width: 200px;
	height: 100vh;
	padding: 1em 2em;

	&:not(:has(+ .chat-active)) {
		&:has(.nav-item:nth-child(n):hover) {
			--n: var(--n);
			--item-top: calc(12px + (var(--n) - 1) * var(--nav-item-height));
			--item-rot: calc((var(--n) % 2 * 2 - 1) * 15deg);
		}
		&:has(.nav-item:nth-child(1):hover) {
			--n: 1;
		}
		&:has(.nav-item:nth-child(2):hover) {
			--n: 2;
		}
		&:has(.nav-item:nth-child(3):hover) {
			--n: 3;
		}
		&:has(.nav-item:nth-child(4):hover) {
			--n: 4;
		}
		&:has(.nav-item:nth-child(5):hover) {
			--n: 5;
		}
	}
}

.side-nav {
	display: flex;
	justify-content: center;
	width: 100%;
	padding-right: 2.25em;
}

.nav-list {
	z-index: 1;
	display: flex;
	flex-direction: column;
	width: 100%;
	padding-right: 1em;
	margin: 0;
	text-align: right;
	list-style: none;
	padding-inline-start: 0;
}

.theme-toggle {
	position: relative;
	right: -2em;
	margin-left: auto;
}

.nav-bubble,
.theme-toggle {
	transition: all 0.3s ease;
}

.theme-toggle {
	transform: rotate(var(--item-rot));
}

#chat-toggle {
	cursor: pointer;
	transition: all 0.3s ease;
}

/* Dark mode toggle styles */
#dark-mode-toggle {
	display: none;
}

#dark-mode-toggle + label {
	border: none;
	background: none;
	font-size: 1em;
	cursor: pointer;
}

#dark-mode-toggle + label::before {
	content: "üêì";
}

#dark-mode-toggle:checked + label::before {
	content: "üê∏";
}

@media (prefers-color-scheme: dark) {
	#dark-mode-toggle:not(:checked) + label::before {
		content: "üêì";
	}
	#dark-mode-toggle:checked + label::before {
		content: "üê∏";
	}
}

:root:has(#dark-mode-toggle:checked) {
	color-scheme: dark;
}

:root:has(#dark-mode-toggle:not(:checked)) {
	color-scheme: light;
}

/* Chat bubble related */
#user-input {
	width: 100%;
	/* Mozilla? */
	padding: 0;
	border: none;
	background: none;
	color: inherit;
	font-family: inherit;
	font-size: inherit;
	outline: none;
}

#user-input::placeholder,
.waiting {
	color: var(--color-gray-50);
	opacity: 0.7;
}

#chat-form {
	width: 100%;
}

#chat-form button {
	display: none;
}

@keyframes ellipsis {
	0% {
		content: ".";
	}
	33% {
		content: "..";
	}
	66% {
		content: "...";
	}
}

.waiting::after {
	content: ".";
	animation: ellipsis 1s infinite;
	display: inline-block;
	width: 1em;
	text-align: left;
}

/* Chat reset */
.chat-reset {
	position: relative;
	display: none;
	padding: 0 0.5em;
	border: none;
	background: none;
	color: gray;
	cursor: pointer;
}

/* Add shadow to nav bubble */
.nav-bubble {
	box-shadow: var(--shadow-elevation-low);
}
.nav-bubble.chat-active {
	box-shadow: var(--shadow-elevation-medium);
}

.nav-bubble.chat-active .chat-reset {
	display: inline-block;
}

/* Only do nav switch on wide screens */
@media (min-width: 840px) {
	.nav-bubble {
		&:where(.chat-active) {
			/* left: calc(50% + 200px); */
			left: calc(200px + 1em);
			/* width: calc(640px - 200px); */
			width: calc(640px - 4em - 2.25em);
		}

		&:where(.chat-active) > * {
			display: block;
		}
	}
}

/* For mobile view */
@media (max-width: 839px) {
	/* Switch side nav off */
	.side-nav {
		display: none;
	}
	/* Mobile */
	.nav-phrase {
		display: inline-block;
	}

	body {
		justify-content: inherit;
		max-width: 40em;
		padding: 0;
		margin: 0 auto;
	}
	.layout-wrapper {
		display: initial;
		max-width: initial;
	}
	main {
		max-width: initial;

		&:where(.chat-active) {
			margin-top: 0;
		}
	}

	header {
		position: relative;
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		width: initial;
		height: initial;
		padding-bottom: 0;
		gap: 1em 0.5em;
	}

	nav {
		flex-direction: column;
	}

	.nav-bubble {
		position: relative;
		left: initial;
		transform: none; /* Reset the transform */
	}
}

/* Util */
.line-clamp {
	display: -webkit-box;
	-webkit-line-clamp: 2;
	-webkit-box-orient: vertical;
	overflow: hidden;
}

.noise-container {
	position: fixed;
	z-index: -1;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-image: var(--noise-img);
	background-size: 182px;
	background-repeat: repeat;
	pointer-events: none;
	opacity: var(--noise-opacity);
}

/* Spotify widget */
.spotify-widget img {
	border-radius: 0.5em;
	box-shadow: var(--shadow-elevation-medium);
}

/* Sidebar progress bar */
.progress-bar {
	position: fixed;
	top: 0;
	left: 0;
	width: 0.5em;
	height: 100vh;
	background-color: var(--color-gray-50);
	transform-origin: 0 0;
	transform: scaleY(0);
}

@supports (animation-timeline: scroll()) {
	html {
		scrollbar-width: none; /* Firefox */
		-ms-overflow-style: none; /* Internet Explorer 10+ */
	}

	html::-webkit-scrollbar {
		display: none; /* Chrome, Safari, and Opera */
		width: 0;
		height: 0;
	}

	.progress-bar {
		animation: grow-progress linear;
		animation-timeline: scroll(root block);
		animation-range: entry 0% cover 100%;
	}

	@keyframes grow-progress {
		to {
			transform: scaleY(1);
		}
	}
}

.citation {
	margin-bottom: 1em;
	padding-left: 2em;
	text-indent: -2em;
}

.citation p {
	margin: 0;
}</style>
	</head>
	<body style="--nav-item-active: 1;">
		<div class="noise-container"></div>
		<a href="#skip" class="visually-hidden">Skip to main content</a>
		<div class="layout-wrapper">
			<header class="site-header">
				<nav>
					<h2 class="visually-hidden">Top level navigation menu</h2>
					<div class="nav-bubble">
    <button id="chat-reset" class="chat-reset" aria-label="Reset chat">‚Ü∫</button>
    <div id="navPhrase" class="nav-phrase">
        
            
            
                <a href="/" style="text-decoration: none;">Home</a> ‚Ä¢
            
                <a href="/projects/" style="text-decoration: none;">Projects</a> ‚Ä¢
            
                <a href="/blog/" style="text-decoration: none;">Blog</a> ‚Ä¢
            
                <a href="/about/" style="text-decoration: none;">About Me</a>
            
        
    </div>
    <form method="post" id="theme-form" class="theme-toggle">
        <input type="checkbox" id="dark-mode-toggle" name="theme" value="dark" aria-label="Toggle dark mode">
        <label for="dark-mode-toggle"></label>
    </form>
</div>
					<div class="side-nav">
						<ul class="nav-list">
							<li id="chat-toggle" class="nav-item">Welcome!</li>
								<li class="nav-item">
									<a href="/">Home</a>
								</li>
								<li class="nav-item">
									<a href="/projects/">Projects</a>
								</li>
								<li class="nav-item">
									<a href="/blog/">Blog</a>
								</li>
								<li class="nav-item">
									<a href="/about/">About Me</a>
								</li>
						</ul>
					</div>
				</nav>

				
			</header>

			<main id="skip" class="container">
				
<div class="progress-bar"></div>

<article class="post">
  <h1>Soniweb: Epilogue</h1>

  <ul class="post-metadata">
    <li>
      <time datetime="2020-04-08">08 April 2020</time>
    </li>
      <li>
        <a href="/tags/projects/" class="post-tag">projects</a>
      </li>
  </ul>

  <h1 id="a-reworking-of-soniweb" tabindex="-1">A Reworking of Soniweb <a class="header-anchor" href="#a-reworking-of-soniweb">#</a></h1>
<p>The <a href="/soniweb">Soniweb</a> project was hurridly completed within the span of about a week. However, in rushing through its implementation, there were a number of unique opertunities that would have been possible with the data we were recieving. Notably, the direction of the packets (whether they were being sent or received) was not considered in the process of our sonification. This information would be quite interesting to have conveyed through sound and provide interesting knowledge about when and how often is your computer uploading information to some other server.</p>
<p>One of the <a href="https://youtu.be/Ocq3NeudsVk">issues</a> I have with sonification is the reasoning (or lack thereof) behind how aspects of data will be sonified. I feel this is a essential point of interpretation artistically that is missed by a lot of sonification projects in the pursuit of making them sonically &quot;beautiful&quot;. Too often the decisions that are being made are not necessarily drawing out acoustic features that parallel the relationships within the data. To this end, I wanted to make three adjustments to the Soniweb project. The <em>first</em> would replace sample playback to synthesized sound at the heart of the sonification, <em>second</em> would focus on shaping the synthesized sound in an extended range of parameters like envelope and pitch based on the features of the incoming packets, and <em>third</em> would be a general optimization of the python script and Pd patch to prevent stuttering or audio glitches during normal use.</p>
<figure><img src="/img/soniweb-2-pd.png" style="aspect-ratio: 16/9;" alt="A little restructured and a much better reverb implementation" /><figcaption>A little restructured and a much better reverb implementation</figcaption></figure>
<h2 id="from-samples-to-fm-synthesis" tabindex="-1">From samples to FM synthesis <a class="header-anchor" href="#from-samples-to-fm-synthesis">#</a></h2>
<p>Our first version of Soniweb used pre-fab samples for each of the different protocols (UDP, DNS, TCP, etc.), meaning there was a considerable amount of processing in simply reading these samples into memory to play in parallel. In the previous version, there was noticeable pops and stutters as a result of web browser usage (page loads), Wireshark's backend listening to packets, and Pd producing an ambisonic environment. So, one major reason in replacing samples with a short generated FM synth would be the benefit it might have on CPU usage and memory within Pure Data.</p>
<h2 id="sonification-of-direction" tabindex="-1">Sonification of direction <a class="header-anchor" href="#sonification-of-direction">#</a></h2>
<p>It's not totally obvious how one goes about representing motions like approach or retreat. However, one nice point of reference is the <a href="https://en.wikipedia.org/wiki/Doppler_effect">Doppler effect</a>, the reason firetrucks seem to have a higher pitch when driving towards the listener and a lower pitch once they have passed. This might be the best feature representative of acoustic motion along with increasing/decreasing volume.
√ç</p>
<figure text-align="center">
    <audio src="https://upload.wikimedia.org/wikipedia/commons/9/90/Speeding-car-horn_doppler_effect_sample.ogg" controls preload="none" class="m-0a display-block"></audio>
    <figcaption>Audio from Wikipedia</figcaption>
</figure>
<p>With this information I planned to give the sense of a sound arriving and departing by creating envelopes that had a short attack/long decay (departing) and long attack/short decay (arriving), each coupled with the proper pitch transformations one would observe with the doppler effect (departing - pitch falling, arriving - pitch rising). However, due to the massive number of packets that are received at once, anything longer than half a second for a single sound would quickly become overwhelming. Thus, a lot of tinkering with the timing and duration of each of these transformations was needed in order to make their different both <strong>intelligible</strong> and <strong>musical</strong>.</p>
<figure><img src="/img/soniweb-2-boop.png" style="aspect-ratio: 16/9;" alt="The new patch for one of the voices" /><figcaption>The new patch for one of the voices</figcaption></figure>
<h2 id="filtering" tabindex="-1">Filtering <a class="header-anchor" href="#filtering">#</a></h2>
<p>Because there would be potentially dozen of packets coming within a single second, I decided to restrict this stream by 1) limiting the packet size and the frequency that packets could be registered in the python script and 2) shortening the max duration of the sound each packet will make to 150ms in Pd. These changes came after a number of other tests to see if limiting the packets by duplicate IP's (no packet can be sent from the same IP in succession) and by duplicate packet size. Both of these alternatives seemed like strange modifications to the data stream and were workarounds for my desired outcome - fewer packets at once.</p>
<p>So, after checking the very scarce documentation of pyshark, I found there was a way to grab the time that a packet was received and restricted the interval between packets manually (5ms). I also made sure that sequential packets of the same size (such as when loading an image) have a subsequently quieter sound.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="highlight-line"><span class="token comment"># Set up capture and filter by host IP and packet size</span></span>
<span class="highlight-line">capture <span class="token operator">=</span> pyshark<span class="token punctuation">.</span>LiveCapture<span class="token punctuation">(</span></span>
<span class="highlight-line">    interface<span class="token operator">=</span><span class="token string">"en0"</span><span class="token punctuation">,</span></span>
<span class="highlight-line">    only_summaries<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="highlight-line">    bpf_filter<span class="token operator">=</span><span class="token string">"ip and host "</span><span class="token operator">+</span>host_ip<span class="token operator">+</span><span class="token string">" and length > "</span><span class="token operator">+</span>pkt_len<span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">for</span> packet <span class="token keyword">in</span> capture<span class="token punctuation">:</span></span>
<span class="highlight-line">        <span class="token comment"># Restrict flow of packets</span></span>
<span class="highlight-line">        pkt_time <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span>time<span class="token punctuation">)</span></span>
<span class="highlight-line">        delta <span class="token operator">=</span> pkt_time <span class="token operator">-</span> prior_time</span>
<span class="highlight-line">        <span class="token keyword">if</span> delta <span class="token operator">></span> <span class="token number">.05</span><span class="token punctuation">:</span></span>
<span class="highlight-line">            prior_time <span class="token operator">=</span> pkt_time</span>
<span class="highlight-line"></span>
<span class="highlight-line">            <span class="token comment"># To OSC</span></span>
<span class="highlight-line">            <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="highlight-line">                <span class="token comment"># For reappearing packets of same size - reduce gain</span></span>
<span class="highlight-line">                <span class="token keyword">if</span> prior_len <span class="token operator">==</span> packet<span class="token punctuation">.</span>length<span class="token punctuation">:</span></span>
<span class="highlight-line">                    client<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span><span class="token string">"/packet_len"</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="highlight-line">                <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="highlight-line">                    client<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span><span class="token string">"/packet_len"</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="highlight-line">                prior_len <span class="token operator">=</span> packet<span class="token punctuation">.</span>length</span></code></pre>
<figcaption>Filters so my ears (and computer) remain intact</figcaption>
<p>There was also a helpful flag within pyshark I had overlooked. The &quot;only_summaries&quot; flag when setting up the LiveCapture significantly reduces the information each packet carries when it enters python. Including it likely made the entire script more efficient, as the information I needed from each packet still existed within just the summaries.</p>
<h2 id="results" tabindex="-1">Results <a class="header-anchor" href="#results">#</a></h2>
<p>Interestingly, the replacement of sound samples with synthesized sound did not initially reduce the CPU usage of the script on the computer I was testing with (a 2013 Macbook Pro). This may simply be a result of how intensive the setup for testing this program but also that I had made quite extensive changes to the structure of the program as well. Both the script, Pure Data, and a web browser (or web intensive application) are needed to run to &quot;feed&quot; Pure Data packets of data. With all of these applications running, Pure Data does struggle a bit and some pops and stutters when webpages are loading, though I have noticed that this behavior with audio interruptions is also common to other applications like Zoom when there is intense web traffic happening at once.</p>
<p>After reworking the filtering system and tinkering a bit with the quality of the reverb I added (to help with spatialization), I think I ended up with something quite nice. Here's a short video, please wear headphones to experience the full effect. The code and patches can be found <a href="https://github.com/jacksongoode/soniweb">here</a>.</p>
<figure><video src="https://www.uio.no/english/studies/programmes/mct-master/blog/assets/video/2020_04_13_jacksong_soniweb2_demo.mp4" style="aspect-ratio: 16/9;" controls>Your browser does not support the video tag.</video><figcaption>A demo of the updated project (headphones required!)</figcaption></figure>

      <ul class="links-nextprev">
          <li>Previous: <a href="/projects/2020-03-09-soniweb/">Soniweb: An Experiment in Web Traffic Sonification and Ambisonics</a>
          </li>
        
          <li>Next: <a href="/projects/2020-05-20-breathing-through-max/">Breathing through Max</a>
          </li>
        
      </ul>
</article>
			</main>
		</div>
		<footer></footer>

		<!-- This page `/projects/2020-04-08-soniweb-2/` was built on 2024-09-04T08:17:08.347Z -->
	</body>
</html>
<script defer>
	// Minimal JS for handling user preference
(function () {
    const toggle = document.getElementById('dark-mode-toggle');

    // Set initial state based on localStorage or system preference
    const storedTheme = localStorage.getItem('color-scheme');
    if (storedTheme) {
        document.documentElement.setAttribute('data-theme', storedTheme);
        toggle.checked = storedTheme === 'dark';
    }

    // Handle toggle changes
    toggle.addEventListener('change', () => {
        const newTheme = toggle.checked ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('color-scheme', newTheme);
    });

    // const form = document.getElementById('theme-form');
    // Handle form submission (for no-JS fallback)
    // form.addEventListener('submit', (e) => {
    //     e.preventDefault();
    //     const formData = new FormData(form);
    //     fetch('/set-theme', {
    //         method: 'POST',
    //         body: formData
    //     }).then(() => {
    //         location.reload();
    //     });
    // });
})();

		const isDevelopment =
	window.location.hostname === "localhost" ||
	window.location.hostname === "127.0.0.1";
const baseUrl = isDevelopment ? "http://localhost:8090" : "";

// Generate a random user ID if not already stored
function getUserId() {
	let userId = localStorage.getItem("userId");
	if (!userId) {
		userId = "user_" + Math.random().toString(36).slice(2, 11);
		localStorage.setItem("userId", userId);
	}
	return userId;
}

function sendMessageToWorker(message) {
	const isDarkMode =
		document.documentElement.getAttribute("data-theme") === "dark";
	const animalParam = isDarkMode ? "frog" : "chicken";
	const waitText = isDarkMode ? "Ribbit" : "Cluck";

	updateNavPhrase(waitText, true);

	const userId = getUserId();

	fetch(
		`${baseUrl}/ai?message=${encodeURIComponent(message)}&animal=${animalParam}&userId=${userId}`,
	)
		.then((response) => response.json())
		.then((data) => {
			updateNavPhrase(data.response || `Error: ${data.error}`);
		})
		.catch((error) => {
			console.error("Fetch error:", error);
			updateNavPhrase("Sorry, something went wrong.");
		});
}

function updateNavPhrase(text, isWaiting = false) {
	const navPhrase = document.getElementById("navPhrase");
	navPhrase.textContent = text;
	navPhrase.classList.toggle("waiting", isWaiting);

	// Add this line to make the chat bubble clickable again after receiving a response
	if (!isWaiting) {
		navPhrase.classList.add("clickable");
	}
}

document.addEventListener("DOMContentLoaded", function () {
	const chatTrigger = document.getElementById("chat-toggle");
	const talkBubble = document.querySelector(".nav-bubble");
	const mainContent = document.querySelector("main");
	const navPhrase = document.getElementById("navPhrase");
	let originalContent = navPhrase.innerHTML;

	const chatReset = document.getElementById("chat-reset");

	function resetChatInterface() {
		navPhrase.innerHTML = originalContent;
		talkBubble.classList.remove("chat-active");
		mainContent.classList.remove("chat-active");
	}

	chatReset.addEventListener("click", resetChatInterface);

	function activateChatInterface() {
		navPhrase.innerHTML = `
			<form id="chat-form">
				<input type="text" id="user-input" placeholder="Type your message...">
				<button type="submit" style="display:none;">Send</button>
			</form>
		`;
		document.getElementById("user-input").focus();

		document
			.getElementById("chat-form")
			.addEventListener("submit", function (e) {
				e.preventDefault();
				const userInput = document.getElementById("user-input");
				if (userInput.value.trim() !== "") {
					sendMessageToWorker(userInput.value.trim());
					userInput.value = "";
				}
			});
	}

	function handleChatTrigger() {
		talkBubble.classList.toggle("chat-active");
		mainContent.classList.toggle("chat-active");

		if (talkBubble.classList.contains("chat-active")) {
			activateChatInterface();
		} else {
			navPhrase.innerHTML = originalContent;
		}
	}

	chatTrigger.addEventListener("click", handleChatTrigger);

	// Modify this event listener to handle clicks on the chat bubble
	navPhrase.addEventListener("click", function (event) {
		// Check if the clicked element is a link
		if (event.target.tagName.toLowerCase() === "a") {
			// If it's a link, let the default action happen (follow the link)
			return;
		}

		if (
			window.innerWidth < 840 &&
			!talkBubble.classList.contains("chat-active")
		) {
			handleChatTrigger();
		} else if (navPhrase.classList.contains("clickable")) {
			activateChatInterface();
			navPhrase.classList.remove("clickable");
		}
	});
});
</script>


<script src="https://cdn.jsdelivr.net/npm/lite-youtube-embed@0.3.3/src/lite-yt-embed.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/lite-vimeo-embed/+esm" defer></script>
