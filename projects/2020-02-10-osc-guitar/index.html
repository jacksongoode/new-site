<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Strumming through space and OSC</title>
		<meta name="description" content="A gesture-driven guitar built in Pure Data, utilizing sensor data from a mobile device">
		<meta name="generator" content="Eleventy v3.0.0">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Jackson">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="Jackson">

		
		
		<link rel="stylesheet" href="/css/prism.css"/>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lite-youtube-embed@0.3.2/src/lite-yt-embed.css">
		
		<style>/*
  Josh's Custom CSS Reset
  https://www.joshwcomeau.com/css/custom-css-reset/
*/
*,
*::before,
*::after {
	box-sizing: border-box;
}
* {
	line-height: calc(1em + 0.5rem);
	margin: 0;
}
body {
	-webkit-font-smoothing: antialiased;
}
img,
picture,
video,
canvas,
svg {
	display: block;
	max-width: 100%;
}
input,
button,
textarea,
select {
	font: inherit;
}
p,
h1,
h2,
h3,
h4,
h5,
h6 {
	overflow-wrap: break-word;
	margin: revert;
}
#root,
#__next {
	isolation: isolate;
}

		:root {
	color-scheme: light dark;
	--color-bg: white;
	--color-gray-20: #333333;
	--color-gray-50: #7f7f7f;
	--color-gray-90: #e5e5e5;
	--font-family: "Rag", -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono,
		Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono,
		Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New,
		Courier, monospace;
	--syntax-tab-size: 2;
	--noise-img: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 600'%3E%3Cfilter id='a'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23a)'/%3E%3C/svg%3E");
	--noise-opacity: 0.2;
	/* Josh Comeau shadows */
	--shadow-color: 0deg 0% 0%;
	--shadow-elevation-low: 0px 0.2px 0.2px hsl(var(--shadow-color) / 0.16),
		0.1px 0.8px 0.8px -3px hsl(var(--shadow-color) / 0.13);
	--shadow-elevation-medium: 0px 0.2px 0.2px hsl(var(--shadow-color) / 0.15),
		0.1px 1px 1.1px -1.5px hsl(var(--shadow-color) / 0.13),
		0.3px 4.2px 4.4px -3px hsl(var(--shadow-color) / 0.11);
	--shadow-elevation-high: 0px 0.2px 0.2px hsl(var(--shadow-color) / 0.14),
		0.1px 1.3px 1.4px -0.6px hsl(var(--shadow-color) / 0.13),
		0.2px 2.8px 2.9px -1.2px hsl(var(--shadow-color) / 0.12),
		0.5px 5.7px 6px -1.8px hsl(var(--shadow-color) / 0.11),
		0.9px 10.9px 11.5px -2.4px hsl(var(--shadow-color) / 0.11),
		1.5px 19.3px 20.3px -3px hsl(var(--shadow-color) / 0.1);
}

/* Both for system and user preference */
:root[data-theme="dark"],
.dark-mode {
	color-scheme: dark;
	--color-bg: black;
	--color-gray-20: #cccccc;
	--color-gray-50: #808080;
	--color-gray-90: #1a1a1a;
	--noise-opacity: 0.1;
}

@font-face {
	font-family: "Switzer";
	src: url("/font/Switzer-Variable.woff2") format("woff2");
	font-weight: 500;
	font-display: optional;
	/* font-variation-settings: "wght" 400; */
}
@font-face {
	font-family: "Rag";
	font-style: normal italic;
	font-weight: 400;
	src:
		url("/font/Rag-Regular.woff2") format("woff2"),
		url("/font/Rag-Italic.woff2") format("woff2"),
		url("/font/Rag-Bold.woff2") format("woff2"),
		url("/font/Rag-BoldItalic.woff2") format("woff2");
	font-display: optional;
}

/* Global stylesheet */
html {
	overflow-x: hidden;
}
html,
body {
	width: 100%;
	padding: 0;
	background-color: Canvas;
	background-color: transparent;
	color: CanvasText;
	font-family: var(--font-family);
}
body {
	/* transition:
		color 0.1s,
		background-color 0.1s; */
	/* background-color: Canvas;
		color: CanvasText; */
	display: flex;
	justify-content: center;
	max-width: none;
}

.layout-wrapper {
	display: flex;
	width: 100%;
	max-width: calc(40em + 200px + 2em);
	min-height: 100vh;
}

main {
	width: 100%;
	max-width: 40em;
	padding: 1em;
	transition: margin 0.3s ease; /* Smooth transition for margin change in chat-active state */

	& :first-child {
		margin-top: 0;
	}

	&:where(.chat-active) {
		margin-top: 3em;
	}
}

/* Typography */
h1,
h2,
h3,
.letter {
	width: fit-content;
	font-family: "Switzer";
	text-wrap: balance;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	position: absolute;
	overflow: hidden;
	width: 1px;
	height: 1px;
	white-space: nowrap;
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
}

p:last-child {
	margin-bottom: 0;
}

.links-nextprev {
	padding: 1em 0;
	border-top: 1px dashed var(--color-gray-20);
	margin-top: 1em;
	list-style: none;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
pre:not([class*="language-"]) {
	margin: 0.5em 0;
	line-height: 1.375; /* 22px /16 */
	text-align: left;
	white-space: pre;
	word-break: normal;
	word-spacing: normal;
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
}
code {
	word-break: break-all;
}

/* Header */
.home-link {
	margin-right: 2em;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
nav {
	position: relative;
	display: flex;
	align-items: baseline;
	width: 100%;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
	padding: 0.25em 0;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
}

/* Each item in a po */
.postlist-item {
	position: relative;
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	padding-left: 1.5em; /* Add left padding to make room for the arrow */
	margin-bottom: 1em;

	&::before {
		content: "\2192"; /* Default to arrow */
		position: absolute;
		top: 0.2em;
		left: 0;
		margin-right: 0.5em;
		color: var(--color-gray-20);
		transition: all 0.5s ease-out;
		filter: saturate(100%);
		transform: scale(1);
	}

	&[data-emoji]::before {
		content: attr(data-emoji);
	}

	&:hover::before,
	&:focus-within::before {
		animation: pulseSat 2s linear infinite;
	}

	&:not(:hover)::before {
		animation: none;
		filter: saturate(100%);
		transform: scale(1);
	}

	.postlist-date::after {
		content: attr(data-tooltip);
		position: absolute;
		overflow: hidden;
		max-width: calc(100% - 12em);
		padding-left: 1em;
		color: var(--color-gray-20);
		text-overflow: ellipsis;
		white-space: nowrap;
		opacity: 0;
		visibility: hidden;
		transition:
			opacity 0.3s ease,
			visibility 0.3s ease;
	}

	&:has(.postlist-link:hover) .postlist-date::after {
		opacity: 1;
		visibility: visible;
	}

	&-active .postlist-link {
		font-weight: bold;
	}
}

@keyframes pulseSat {
	0%,
	50%,
	100% {
		filter: saturate(100%);
		transform: scale(1);
	}
	25% {
		filter: saturate(50%);
		transform: scale(0.8);
	}
	75% {
		filter: saturate(150%);
		transform: scale(1.2);
	}
}
.postlist-date {
	color: var(--color-gray-20);
	font-size: 0.8125em; /* 13px /16 */
	word-spacing: -0.5px;
}
.postlist-link {
	flex-basis: 100%;
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}

/* Tags */
.post-tag {
	display: inline-flex;
	justify-content: center;
	align-items: center;
	font-style: italic;
	text-transform: capitalize;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	margin-left: 0.1em;
	font-size: 1em;
	font-style: normal;
	text-decoration: none;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

/* Figures */
figure {
	margin: 1em 0;
}
figure > * {
	max-width: 100%;
	margin: 0 auto;
}
/* All images & videos should be in a figure */
figure :first-child {
	border-radius: 0.5em;
	box-shadow: var(--shadow-elevation-medium);
}

figcaption {
	margin-top: 0.5em;
	color: var(--color-gray-20);
	text-align: center;
}

blockquote {
	padding-left: 1em;
	border-left: 2px solid ButtonFace;
}

/* Talk bubble styling */
.nav-phrase {
	display: none;
	width: 100%;
	padding: 0 0.5em;
	cursor: text;
}

.nav-bubble {
	position: absolute;
	display: flex;
	justify-content: space-between;
	align-items: center;
	width: calc(100% - 2.5em);
	padding: 0.25em;
	margin: 0;
	background: ButtonFace;
	transition: all 0.3s ease;
	transform: translateY(calc(var(--item-top) - 12px));
	border-radius: 0.25em;

	&:after {
		content: "";
		position: absolute;
		top: 50%;
		right: -7.5px;
		border: 7.5px solid transparent;
		border-right: 0;
		margin-top: -7.5px;
		border-left-color: ButtonFace;
	}

	/* Reset position when chat is active */
	&:where(.chat-active) {
		transform: none;
	}
}

/* Talk bubble movement */
header {
	/* We need to add 1 to the active item to account for the first item */
	--item-top: calc(12px + var(--nav-item-active, 1) * var(--nav-item-height));
	--item-rot: 0deg;
	--nav-item-height: 32px;

	position: sticky;
	top: 0;
	justify-content: end;
	align-items: start;
	width: 200px;
	height: 100vh;
	padding: 1em;

	&:not(:has(+ .chat-active)) {
		&:has(.nav-item:nth-child(n):hover) {
			--n: var(--n);
			--item-top: calc(12px + (var(--n) - 1) * var(--nav-item-height));
			--item-rot: calc((var(--n) % 2 * 2 - 1) * 15deg);
		}
		&:has(.nav-item:nth-child(1):hover) {
			--n: 1;
		}
		&:has(.nav-item:nth-child(2):hover) {
			--n: 2;
		}
		&:has(.nav-item:nth-child(3):hover) {
			--n: 3;
		}
		&:has(.nav-item:nth-child(4):hover) {
			--n: 4;
		}
		&:has(.nav-item:nth-child(5):hover) {
			--n: 5;
		}
	}
}

.side-nav {
	display: flex;
	justify-content: center;
	width: 100%;
	padding-right: 2em;
}

.nav-list {
	z-index: 1;
	display: flex;
	flex-direction: column;
	width: 100%;
	padding-right: 1em;
	margin: 0;
	text-align: right;
	list-style: none;
	padding-inline-start: 0;
}

.theme-toggle {
	position: relative;
	right: -2em;
	margin-left: auto;
}

.nav-bubble,
.theme-toggle {
	transition: all 0.3s ease;
}

.theme-toggle {
	transform: rotate(var(--item-rot));
}

#chat-toggle {
	cursor: pointer;
	transition: all 0.3s ease;
}

/* Dark mode toggle styles */
#dark-mode-toggle {
	display: none;
}

#dark-mode-toggle + label {
	border: none;
	background: none;
	font-size: 1em;
	cursor: pointer;
}

#dark-mode-toggle + label::before {
	content: "🐓";
}

#dark-mode-toggle:checked + label::before {
	content: "🐸";
}

@media (prefers-color-scheme: dark) {
	#dark-mode-toggle:not(:checked) + label::before {
		content: "🐓";
	}
	#dark-mode-toggle:checked + label::before {
		content: "🐸";
	}
}

:root:has(#dark-mode-toggle:checked) {
	color-scheme: dark;
}

:root:has(#dark-mode-toggle:not(:checked)) {
	color-scheme: light;
}

/* Chat bubble related */
#user-input {
	width: 100%;
	/* Mozilla? */
	padding: 0;
	border: none;
	background: none;
	color: inherit;
	font-family: inherit;
	font-size: inherit;
	outline: none;
}

#user-input::placeholder,
.waiting {
	color: var(--color-gray-50);
	opacity: 0.7;
}

#chat-form {
	width: 100%;
}

#chat-form button {
	display: none;
}

@keyframes ellipsis {
	0% {
		content: ".";
	}
	33% {
		content: "..";
	}
	66% {
		content: "...";
	}
}

.waiting::after {
	content: ".";
	animation: ellipsis 1s infinite;
	display: inline-block;
	width: 1em;
	text-align: left;
}

/* Chat reset */
.chat-reset {
	position: relative;
	display: none;
	padding: 0 0.5em;
	border: none;
	background: none;
	color: gray;
	cursor: pointer;
}

/* Add shadow to nav bubble */
.nav-bubble {
	box-shadow: var(--shadow-elevation-low);
}
.nav-bubble.chat-active {
	box-shadow: var(--shadow-elevation-medium);
}

.nav-bubble.chat-active .chat-reset {
	display: inline-block;
}

/* Only do nav switch on wide screens */
@media (min-width: 840px) {
	.nav-bubble {
		&:where(.chat-active) {
			/* left: calc(50% + 200px); */
			/* width: calc(640px - 200px); */
			left: calc(200px);
			width: calc(640px - 4.5em);
		}

		&:where(.chat-active) > * {
			display: block;
		}
	}
}

/* For mobile view */
@media (max-width: 839px) {
	/* Switch side nav off */
	.side-nav {
		display: none;
	}
	/* Mobile */
	.nav-phrase {
		display: inline-block;
	}

	body {
		justify-content: inherit;
		max-width: 40em;
		padding: 0;
		margin: 0 auto;
	}
	.layout-wrapper {
		display: initial;
		max-width: initial;
	}
	main {
		max-width: initial;

		&:where(.chat-active) {
			margin-top: 0;
		}
	}

	header {
		position: relative;
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		width: initial;
		height: initial;
		padding-bottom: 0;
		gap: 1em 0.5em;
	}

	nav {
		flex-direction: column;
	}

	.nav-bubble {
		position: relative;
		left: initial;
		transform: none; /* Reset the transform */
	}
}

/* Util */
.line-clamp {
	display: -webkit-box;
	-webkit-line-clamp: 2;
	-webkit-box-orient: vertical;
	overflow: hidden;
}

.noise-container {
	position: fixed;
	z-index: -1;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-image: var(--noise-img);
	background-size: 182px;
	background-repeat: repeat;
	pointer-events: none;
	opacity: var(--noise-opacity);
}

/* Spotify widget */
.spotify-widget img {
	border-radius: 0.5em;
	box-shadow: var(--shadow-elevation-medium);
}

/* Sidebar progress bar */
.progress-bar {
	position: fixed;
	top: 0;
	left: 0;
	width: 0.5em;
	height: 100vh;
	background-color: var(--color-gray-50);
	transform-origin: 0 0;
	transform: scaleY(0);
}

@supports (animation-timeline: scroll()) {
	html {
		scrollbar-width: none; /* Firefox */
		-ms-overflow-style: none; /* Internet Explorer 10+ */
	}

	html::-webkit-scrollbar {
		display: none; /* Chrome, Safari, and Opera */
		width: 0;
		height: 0;
	}

	.progress-bar {
		animation: grow-progress linear;
		animation-timeline: scroll(root block);
		animation-range: entry 0% cover 100%;
	}

	@keyframes grow-progress {
		to {
			transform: scaleY(1);
		}
	}
}

.citation {
	padding-left: 2em;
	margin-bottom: 1em;
	text-indent: -2em;
}

.citation p {
	margin: 0;
}</style>
	</head>
	<body style="--nav-item-active: 1;">
		<div class="noise-container"></div>
		<a href="#skip" class="visually-hidden">Skip to main content</a>
		<div class="layout-wrapper">
			<header class="site-header">
				<nav>
					<h2 class="visually-hidden">Top level navigation menu</h2>
					<div class="nav-bubble">
    <button id="chat-reset" class="chat-reset" aria-label="Reset chat">↺</button>
    <div id="navPhrase" class="nav-phrase">
        
            
            
                <a href="/" style="text-decoration: none;">Home</a> •
            
                <a href="/projects/" style="text-decoration: none;">Projects</a> •
            
                <a href="/blog/" style="text-decoration: none;">Blog</a> •
            
                <a href="/about/" style="text-decoration: none;">About Me</a>
            
        
    </div>
    <form method="post" id="theme-form" class="theme-toggle">
        <input type="checkbox" id="dark-mode-toggle" name="theme" value="dark" aria-label="Toggle dark mode">
        <label for="dark-mode-toggle"></label>
    </form>
</div>
					<div class="side-nav">
						<ul class="nav-list">
							<li id="chat-toggle" class="nav-item">Welcome!</li>
								<li class="nav-item">
									<a href="/">Home</a>
								</li>
								<li class="nav-item">
									<a href="/projects/">Projects</a>
								</li>
								<li class="nav-item">
									<a href="/blog/">Blog</a>
								</li>
								<li class="nav-item">
									<a href="/about/">About Me</a>
								</li>
						</ul>
					</div>
				</nav>

				
			</header>

			<main id="skip" class="container">
				
<div class="progress-bar"></div>

<article class="post">
  <h1>Strumming through space and OSC</h1>

  <ul class="post-metadata">
    <li>
      <time datetime="2020-02-10">10 February 2020</time>
    </li>
      <li>
        <a href="/tags/projects/" class="post-tag">projects</a>
      </li>
  </ul>

  <h1 id="an-osc-guitar" tabindex="-1">An OSC Guitar <a class="header-anchor" href="#an-osc-guitar">#</a></h1>
<p>My second project for the audio programming course was to accurately simulate a guitar strum in <a href="https://puredata.info/">Pure Data</a> (Pd) using the sensors on a mobile device. I wanted its interaction to be reflective of the direction, speed, and acoustic uniqueness of a real guitar strum. By uniqueness I mean the qualities of a strum that are not necessarily intended by the musician, like the intensity of each string strike and the delay between each individual string as the fingers (or pick) slide across the strings. These additions make both the sound and the experience of strumming quite realistic and, as implemented in this patch, benefit the realism of the virtual strum. However, a number of unforeseen difficulties made the feat of a seamless gesture-to-sound production a challenge. As I will discuss, one of the greatest barriers to responsiveness was network latency and the inability for native, local interfacing within both Pure Data and sensor data on my mobile device.</p>
<figure><img src="oscguitar-g-main.png" style="aspect-ratio: 16/9;" alt="Frontpage of Pd patch" /><figcaption>Frontpage of Pd patch</figcaption></figure>
<h2 id="strings-and-things" tabindex="-1">Strings and Things <a class="header-anchor" href="#strings-and-things">#</a></h2>
<p>I began the project with a detailed search for an accurate model of a string. While I could have built a simple string, the focus of my work was integrating the string model into a framework from which it could serve as a guitar. The string was built using a digital waveguide model by <a href="https://ccrma.stanford.edu/realsimple/waveguideintro/">Edgar J. Berdahl and Julius O. Smith</a>. Their model is quite good, both to the ear and to the standards of Stanford's Department of Music.</p>
<figure><img src="oscguitar-g-waveguide.png" style="aspect-ratio: 16/9;" alt="Waveguide model of a string" /><figcaption>Waveguide model of a string</figcaption></figure>
<p>However, the model was not designed in a way to be used in polyphony. To correct their design, I renamed each array, send, and receive to be unique for each instance of the waveguide model using a prefix of &quot;$0-&quot;. This allowed each object to be instantiated with a unique identity and as a result, enabled the messages passed by each of the six strings to exist without overwriting potential shared arrays or variables. I also reformatted some of their code to better fit my purposes like adding inlets and outlets that would communicate with the main patch and the six strings in concert. I also cleaned and reorganized their layouts to make more functional sense (it was messy, sorry Stanford).</p>
<figure><img src="oscguitar-g-model.png" style="aspect-ratio: 16/9;" alt="The guitar model sub-patch" /><figcaption>The guitar model sub-patch</figcaption></figure>
<p>Once the strings were in place, I assigned the fundamental frequency of each string of four chords to four messages and made a simple metronome to send a chord pattern to play the chords (for a non-interactive demo). To create a delay between each string I used the &quot;pipe&quot; object prior to reaching the waveguide model. The delays' right-hand argument allows for an input number, whose sign (positive of negative) determines whether the string delays will cascade downwards or upwards. The expression also considers randomness by calling six variables that were assigned six random numbers included in the sub-patch &quot;rnd-strings&quot;.</p>
<figure><img src="oscguitar-rnd-strings.png" style="aspect-ratio: 16/9;" alt="Sub-patch for the randomizer" /><figcaption>Sub-patch for the randomizer</figcaption></figure>
<p>These random variables are created on every &quot;strum-bang&quot;, a global variable used to send a bang when there is a strum (either from the metro or OSC). The random variables in the delay between each string pluck increase or decrease the total delay time. This delay between each string in a strum is also factored by the acceleration of the strum). After the audio signals are generated, they have their amplitude reduced by the same random factors used before. There is then some light panning of the mono signals of the top two and bottom two strings. This is finally sent to the dac.</p>
<h2 id="the-notorious-osc" tabindex="-1">The Notorious OSC <a class="header-anchor" href="#the-notorious-osc">#</a></h2>
<figure><img src="https://sensors2.org/wp-content/uploads/2015/02/osc.png" style="aspect-ratio: 16/9;" alt="Sensor2OSC" /><figcaption>Sensor2OSC</figcaption></figure>
<p>The last step was into employ a method to send <a href="https://en.wikipedia.org/wiki/Open_Sound_Control">OSC</a> messages, generated from my smartphone's sensors, to the patch running on my computer. I used the Android app <a href="https://github.com/SensorApps/Sensors2OSC">Sensors2OSC</a> to send OSC messages from the gravity and linear acceleration sensors in the phone. I assigned the IP and port within the Android app to which the OSC messages would be sent and then assigned the same port within the patch to receive these messages over the local network (though it could be potentially on any network). For sensor data, I chose the gravity sensor over the accelerometer sensor because the tilt values that correspond to rotating the top of the phone downwards and upwards were distinctly positive and negative as the top the crossed over the y-axis (horizon).</p>
<figure><img src="oscguitar-g-osc.png" style="aspect-ratio: 16/9;" alt="Receiving and manipulating OSC data from the phone" /><figcaption>Receiving and manipulating OSC data from the phone</figcaption></figure>
<p>Two mechanisms were created to trigger a bang from a strum using the phone. The first opens or closs a gate depending on whether or not there is a sufficient change in the tilt of the top of the phone from the gravity sensor. The second mechanism determines if the acceleration of the strum is enough to trigger a bang. In its design, the second impulse generator can only be activated if there is enough of a properly shaped strum gesture. In addition to the thresholds preventing any rapid activation, I also created a refractory period that prevents a bang from being sent until the previous strum has completed from calculating strum duration. The impulse that is sent when a strum makes it through the thresholds is a positive value from the linear acceleration. The sign of this number is then changed depending on whether the strum was down or up (using the sign of the gravity sensor's change). This number determines the speed and direction of the strum. If all thresholds were tuned perfectly and there was zero latency (my next point), this would allow rapid strumming of the virtual guitar.</p>
<h2 id="complications" tabindex="-1">Complications <a class="header-anchor" href="#complications">#</a></h2>
<p>Unfortunately, one of the first issues I recognized was the latency that appeared from communicating over the local network. The latency was also inconsistent as well as the message rate that was being received (not to mention messages dropped). There were some moments where the speed and response of the OSC messages was incredibly fast and at other times inoperably slow. Because of this, a good portion of my time was spent finding threshold values and averages that catered to the message rate and latency. There is also the issue of this configuration being device dependent. Different smartphones will likely have different sensor hardware, sensor names, ranges, rates, etc. so this patch is certain to need some configuring in each case. The initial goal of this project was to build the app in Pd and afterwards &quot;simply and easily&quot; port it over to the <a href="https://danieliglesia.com/mobmuplat/">MobMuPlat</a> application for Android and iOS. However, this app does not appear to read the necessary sensor data natively and there do not appear to be alternatives in hosting Pd patches on Android. For the time being, this patch will have to be hosted on a remote computer and receive OSC messages from a device connected to the same network.</p>
<figure><video src="vid/osc-guitar.mp4" style="aspect-ratio: 16/9;" controls>Your browser does not support the video tag.</video><figcaption>Video demo of the OSC functionality - credit: Thomas Anda</figcaption></figure>
<p>The audio within the video was recorded internally (oddly the pops only appeared after video editing - my computer was struggling with that fabulous transition).</p>
<p>All in all, this project was a great introduction to Pure Data and definitely taught us the general principles of the language as well as some of the challenges you only encounter in hour 11 of debugging. While making this a standalone app would require a bit more investigation into MobMuPlat or some other Pd host-able interface, I think my goals were met. And when the network connection is good and the thresholds are polished, it's quite suprising how responsive a network connection can be.</p>
<p>My project's code can be found <a href="https://github.com/jacksongoode/osc-guitar">here</a>.</p>
<h2 id="works-cited" tabindex="-1">Works Cited <a class="header-anchor" href="#works-cited">#</a></h2>
<p class="citation">Iglesia, Daniel. (2020). <em>Monkeyswarm/MobMuPlat</em>. Retrieved from <a href="https://github.com/monkeyswarm/MobMuPlat">https://github.com/monkeyswarm/MobMuPlat</a></p>
<p class="citation">MobMuPlat. (2020). <em>Mobile Music Platform</em>. Retrieved from <a href="https://danieliglesia.com/mobmuplat/">https://danieliglesia.com/mobmuplat/</a></p>
<p class="citation">CCRMA. (2020). <em>Plucked String Digital Waveguide Model</em>. Retrieved from <a href="https://ccrma.stanford.edu/realsimple/waveguideintro/">https://ccrma.stanford.edu/realsimple/waveguideintro/</a></p>
<p class="citation">SensorApps. (2020). <em>SensorApps/Sensors2OSC</em>. Retrieved from <a href="https://github.com/SensorApps/Sensors2OSC">https://github.com/SensorApps/Sensors2OSC</a></p>
<p class="citation">Sensors2. (2020). <em>Sensors2OSC</em>. Retrieved from <a href="https://sensors2.org/osc/">https://sensors2.org/osc/</a></p>
      <ul class="links-nextprev">
          <li>Next: <a href="/projects/2020-03-09-soniweb/">Soniweb: An Experiment in Web Traffic Sonification and Ambisonics</a>
          </li>
        
      </ul>
</article>
			</main>
		</div>
		<footer></footer>

		<!-- This page `/projects/2020-02-10-osc-guitar/` was built on 2024-09-05T08:12:29.345Z -->
	</body>
</html>
<script defer>
	// Minimal JS for handling user preference
(function () {
    const toggle = document.getElementById('dark-mode-toggle');

    // Set initial state based on localStorage or system preference
    const storedTheme = localStorage.getItem('color-scheme');
    if (storedTheme) {
        document.documentElement.setAttribute('data-theme', storedTheme);
        toggle.checked = storedTheme === 'dark';
    }

    // Handle toggle changes
    toggle.addEventListener('change', () => {
        const newTheme = toggle.checked ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('color-scheme', newTheme);
    });

    // const form = document.getElementById('theme-form');
    // Handle form submission (for no-JS fallback)
    // form.addEventListener('submit', (e) => {
    //     e.preventDefault();
    //     const formData = new FormData(form);
    //     fetch('/set-theme', {
    //         method: 'POST',
    //         body: formData
    //     }).then(() => {
    //         location.reload();
    //     });
    // });
})();

		const isDevelopment =
	window.location.hostname === "localhost" ||
	window.location.hostname === "127.0.0.1";
const baseUrl = isDevelopment ? "http://localhost:8090" : "";

// Generate a random user ID if not already stored
function getUserId() {
	let userId = localStorage.getItem("userId");
	if (!userId) {
		userId = "user_" + Math.random().toString(36).slice(2, 11);
		localStorage.setItem("userId", userId);
	}
	return userId;
}

function sendMessageToWorker(message) {
	const isDarkMode =
		document.documentElement.getAttribute("data-theme") === "dark";
	const animalParam = isDarkMode ? "frog" : "chicken";
	const waitText = isDarkMode ? "Ribbit" : "Cluck";

	updateNavPhrase(waitText, true);

	const userId = getUserId();

	fetch(
		`${baseUrl}/ai?message=${encodeURIComponent(message)}&animal=${animalParam}&userId=${userId}`,
	)
		.then((response) => response.json())
		.then((data) => {
			updateNavPhrase(data.response || `Error: ${data.error}`);
		})
		.catch((error) => {
			console.error("Fetch error:", error);
			updateNavPhrase("Sorry, something went wrong.");
		});
}

function updateNavPhrase(text, isWaiting = false) {
	const navPhrase = document.getElementById("navPhrase");
	navPhrase.textContent = text;
	navPhrase.classList.toggle("waiting", isWaiting);

	// Add this line to make the chat bubble clickable again after receiving a response
	if (!isWaiting) {
		navPhrase.classList.add("clickable");
	}
}

document.addEventListener("DOMContentLoaded", function () {
	const chatTrigger = document.getElementById("chat-toggle");
	const talkBubble = document.querySelector(".nav-bubble");
	const mainContent = document.querySelector("main");
	const navPhrase = document.getElementById("navPhrase");
	let originalContent = navPhrase.innerHTML;

	const chatReset = document.getElementById("chat-reset");

	function resetChatInterface() {
		navPhrase.innerHTML = originalContent;
		talkBubble.classList.remove("chat-active");
		mainContent.classList.remove("chat-active");
	}

	chatReset.addEventListener("click", resetChatInterface);

	function activateChatInterface() {
		navPhrase.innerHTML = `
			<form id="chat-form">
				<input type="text" id="user-input" placeholder="Type your message...">
				<button type="submit" style="display:none;">Send</button>
			</form>
		`;
		document.getElementById("user-input").focus();

		document
			.getElementById("chat-form")
			.addEventListener("submit", function (e) {
				e.preventDefault();
				const userInput = document.getElementById("user-input");
				if (userInput.value.trim() !== "") {
					sendMessageToWorker(userInput.value.trim());
					userInput.value = "";
				}
			});
	}

	function handleChatTrigger() {
		talkBubble.classList.toggle("chat-active");
		mainContent.classList.toggle("chat-active");

		if (talkBubble.classList.contains("chat-active")) {
			activateChatInterface();
		} else {
			navPhrase.innerHTML = originalContent;
		}
	}

	chatTrigger.addEventListener("click", handleChatTrigger);

	// Modify this event listener to handle clicks on the chat bubble
	navPhrase.addEventListener("click", function (event) {
		// Check if the clicked element is a link
		if (event.target.tagName.toLowerCase() === "a") {
			// If it's a link, let the default action happen (follow the link)
			return;
		}

		if (
			window.innerWidth < 840 &&
			!talkBubble.classList.contains("chat-active")
		) {
			handleChatTrigger();
		} else if (navPhrase.classList.contains("clickable")) {
			activateChatInterface();
			navPhrase.classList.remove("clickable");
		}
	});
});
</script>


<script src="https://cdn.jsdelivr.net/npm/lite-youtube-embed@0.3.3/src/lite-yt-embed.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/lite-vimeo-embed/+esm" defer></script>
